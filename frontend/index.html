<!DOCTYPE html>
<html>
<head>
    <title>Collecting Data</title>
    <link rel="stylesheet" type="text/css" href="app.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
</head>
<body>
    <div class="greeting">
        <h2>Welcome to UC Berkeley's DeepDrive Research Experiment</h2>
        <p>Take a look as we play the following video, pretending as if you are driving the car. If you perceive a dangerous situation, click on the red button; we will take a note of which frame that scenario corresponds to. This will help us greatly in our autonomous driving research study at the Whitney Laboratory here at UC Berkeley!</p>
        <p><i>Loosely speaking, a "dangerous situation" is defined as one where you, as the driver, feel you need to take immediate action in order to avoid an accident</i></p>
    </div>
    <div style="text-align:center;"><button id="begin" class="begin" onclick="startVid()">Start Video</button></div>
    
    <div class="video">
        <video id="video" width="560" height="315">
            <source src="driving.mp4" type="video/mp4">
        </video>
    </div>
    
    <div style="text-align:center;"><button class="danger" id="danger">Hit Spacebar if Danger Scenario Observed</button></div>
    <div style="text-align:center; white-space: pre-wrap;" id="clickLog"></div>
<!--    <div style="text-align:center;"><button class="danger" onclick="logClick2()">Random</button></div>-->
    
<!--    <div class="video"><iframe id="video" width="560" height="315" src="https://www.youtube.com/embed/wooe5niJi9c?rel=0&amp;showinfo=0" frameborder="0" allow="autoplay; encrypted-media"></iframe></div>-->
    
    <script type="text/javascript">
        var seconds = 0;
        var dangerLogs = [];
        var duration = 1000;
        var vidStarted = false;
        function startVid() {
            if (!vidStarted) {
                var vid = document.getElementById("video");
                duration = vid.duration;
                document.getElementById("begin").textContent = "Video has begun...enjoy!";
                vid.play();
                seconds = new Date().getTime() / 1000; //double check if this still is accurate when video has to load for 2+ sec
                vid.addEventListener('ended', endVid, false);
                vidStarted = true;
            }
        }
//        function logClick() {
//            var seconds2 = new Date().getTime() / 1000;
//            var secondsElapsed = seconds2 - seconds;
//            var text = "<p>Click at " + Math.round(secondsElapsed * 100) / 100 + " seconds</p>";
//            document.getElementById("clickLog").innerHTML = text + document.getElementById("clickLog").innerHTML;
//            dangerLogs.push(secondsElapsed);
//        }
        document.body.onkeyup = function(e){
            if(e.keyCode == 32){
                if (vidStarted) {
                    var seconds2 = new Date().getTime() / 1000;
                    var secondsElapsed = seconds2 - seconds;
                    var text = "<p>Click at " + Math.round(secondsElapsed * 100) / 100 + " seconds</p>";
                    document.getElementById("clickLog").innerHTML = text + document.getElementById("clickLog").innerHTML;
                    dangerLogs.push(secondsElapsed);
                }
            }
        }
        function endVid(e) {
            vidStarted = false;
            $.ajax({
            type: 'GET',
            data: {"name": JSON.stringify(dangerLogs), "url": "driving2.mp4"},
            url: 'http://localhost:3000/send',
            success: function(data) {
                alert('Thank you for completing this experiment! Your data has been saved, and will help us tremendously in building our models. Feel free to close this tab.');}});
        }
        window.addEventListener('keydown', function(e) {
          if(e.keyCode == 32 && e.target == document.body) {
            e.preventDefault();
          }
        });
    </script>
</body>
</html>